{"remainingRequest":"D:\\my-project\\digit\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\my-project\\digit\\src\\views\\rooms\\index.vue?vue&type=style&index=0&id=7a8ad951&lang=less&","dependencies":[{"path":"D:\\my-project\\digit\\src\\views\\rooms\\index.vue","mtime":1682245211045},{"path":"D:\\my-project\\digit\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\my-project\\digit\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\my-project\\digit\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\my-project\\digit\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\my-project\\digit\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\my-project\\digit\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgICAjY29udGFpbmVyIHsKCQl3aWR0aDogMTAwJTsKICAgICAgICBoZWlnaHQ6IDEwODBweDsKCX0KICAgIC5zd2l0Y2h7CiAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgIHJpZ2h0OiAyNHB4OwogICAgICAgIHRvcDogNDAlOwogICAgICAgIHotaW5kZXg6IDEwMDsKICAgICAgICAuYnV0dG9uewogICAgICAgICAgICB3aWR0aDogODBweDsKICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI3LCAyNSwgMjQsIC4zKTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDEycHggOHB4IDEycHggMjRweDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KICAgIH0KCiAgICAucG9pbnR7CiAgICAgICAgLy8gYmFja2dyb3VuZC1jb2xvcjogYW50aXF1ZXdoaXRlOwogICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICB0b3A6IDUwJTsKICAgICAgICBsZWZ0OiA1MCU7CiAgICAgICAgei1pbmRleDoxMDsKICAgIH0KIAogICAgICAKICAgIC5sYWJlbC1zb2ZhewogICAgICAgIC5sYWJlbC10aXBzCiAgICAgICAgIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBsZWZ0OiAtMjIwcHg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3ctcmV2ZXJzZTsKICAgICAgICAgfQogICAgfQogICAgICAgCiAgICAubGFiZWx7CiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgwLCAwKTsKICAgICAgICB3aWR0aDogMTIwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgLjYpOwogICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgcGFkZGluZzogMTBweDsKICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgbGluZS1oZWlnaHQ6IDMycHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDEwMDsKICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgY3Vyc29yOiBoZWxwOwogICAgICAgIC5sYWJlbC10aXBzewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgIC5pbmZvewogICAgICAgICAgICAgICAgLnAxewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAuY292ZXJ7CiAgICAgICAgICAgICAgICB3aWR0aDoyMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDYwcHg7CiAgICAgICAgICAgICAgICAuaWNvbnsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQogICAgLnZpc2libGUgLmxhYmVsewogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMSwgMSk7CiAgICB9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA2YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/rooms","sourcesContent":["<template>\r\n    <div class=\"webGl-page\">\r\n        <div id=\"container\"></div>\r\n         <!-- 场景切换点 -->\r\n        <div class=\"switch\">\r\n            <span class=\"button\" v-for=\"(room, index) in rooms\" :key=\"index\" @click=\"handleSwitch(room.key)\" v-show=\"room.key !== currentRoom\">\r\n                <b class=\"text\">{{ room.name }}</b>\r\n                <i class=\"icon\"></i>\r\n            </span>\r\n        </div>\r\n\r\n        <!-- 交互点 -->\r\n        <div  class=\"point\"  v-for=\"(point, index) in interactivePoints\" :key=\"index\" \r\n            :class=\"[`point-${index}`, `point-${point.key}`]\"\r\n            @click=\"handlePoint(point)\"\r\n           >\r\n            <div class=\"label\" :class=\"[`label-${index}`, `label-${point.key}`]\">\r\n                <div class=\"label-tips\">\r\n                    <div class=\"cover\">\r\n                        <i  class=\"icon\" :style=\"{ 'background': `url(${point.cover}) no-repeat center`, 'background-size': 'contain'}\"></i>\r\n                    </div>\r\n                    <div class=\"info\">\r\n                        <p class=\"p1\">{{ point.value }}</p>\r\n                        <p class=\"p2\">{{ point.description }}</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as Three from 'three'\r\nimport TWEEN from '@tweenjs/tween.js'\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\n// import { VRButton } from 'three/addons/webxr/VRButton.js';\r\n// import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nexport default {\r\n    data(){\r\n        return{\r\n            renderer: '', //渲染器\r\n            scene: '', //场景\r\n            light: '', //光源\r\n            camera: '', //相机\r\n            controls: '', //控制器\r\n            mesh:null,\r\n            currentRoom: 'living-room',\r\n            rooms:[\r\n                {\r\n                    name: '客厅',\r\n                    key: 'living-room',\r\n                    map: require('../../assets/images/map/map_living_room.jpg'),\r\n                    showSwitch: true,\r\n                    position: new Three.Vector3(0, 0, 0),\r\n                    interactivePoints: [\r\n                        {\r\n                            key: 'tv',\r\n                            value: '电视机',\r\n                            description: '智能电视',\r\n                            cover: require('../../assets/images/home/cover_living_room_tv.png'),\r\n                            // cover: new URL('@/assets/images/home/cover_living_room_tv.png', import.meta.url).href,\r\n                            position: new Three.Vector3(-6, 2, -8),\r\n                        },\r\n                        {\r\n                            key: 'fridge',\r\n                            value: '冰箱',\r\n                            description: '豪华冰箱',\r\n                            cover: require('../../assets/images/home/cover_living_room_fridge.png'),\r\n                            // cover: new URL('@/assets/images/home/cover_living_room_fridge.png', import.meta.url).href,\r\n                            position: new Three.Vector3(-12, 4, 9),\r\n                        },\r\n                        {\r\n                            key: 'sofa',\r\n                            value: '沙发',\r\n                            description: '舒适沙发',\r\n                            cover: require('../../assets/images/home/cover_living_room_sofa.png'),\r\n                            // cover: new URL('@/assets/images/home/cover_living_room_sofa.png', import.meta.url).href,\r\n                            position: new Three.Vector3(6, 0, -8),\r\n                        },\r\n                    ],\r\n                },\r\n                {\r\n                    name: '卧室',\r\n                    key: 'bed-room',\r\n                    map: require('../../assets/images/map/map_bed_room.jpg'),\r\n                    showSwitch: true,\r\n                    position: new Three.Vector3(-32, 0, 0),\r\n                    interactivePoints: [\r\n                        {\r\n                            key: 'bed',\r\n                            value: '床',\r\n                            description: '温暖的床',\r\n                            cover: require('../../assets/images/home/cover_bed_room_bed.png'),\r\n                            // cover: new URL('@/assets/images/home/cover_bed_room_bed.png', import.meta.url).href,\r\n                            position: new Three.Vector3(-38, 2, -14),\r\n                        },\r\n                    ],\r\n                },\r\n                {\r\n                    name: '书房',\r\n                    key: 'study-room',\r\n                    map: require('../../assets/images/map/map_study_room.jpg'),\r\n                    showSwitch: true,\r\n                    position: new Three.Vector3(32, 0, 0),\r\n                    interactivePoints: [\r\n                        {\r\n                            key: 'art',\r\n                            value: '艺术品',\r\n                            description: '绝版作品',\r\n                            cover: require('../../assets/images/home/cover_study_room_art.png'),\r\n                            // cover: new URL('@/assets/images/home/cover_study_room_art.png', import.meta.url).href,\r\n                            position: new Three.Vector3(42, 6, -8),\r\n                        },\r\n                    ]\r\n                },\r\n            ]\r\n        }\r\n    },\r\n    created(){\r\n        \r\n    },\r\n    mounted(){\r\n        this.init()\r\n        this.animate()\r\n        this.initPoint()\r\n          // 页面重绘时调用自身\r\n        // window.requestAnimationFrame(this.initPoint);\r\n    },\r\n    computed:{\r\n        interactivePoints(){\r\n            const res = [];\r\n            this.rooms.forEach((room) => {\r\n                if (room.interactivePoints && room.interactivePoints.length > 0) {\r\n                    room.interactivePoints.forEach((point) => {\r\n                        point = {\r\n                            room: room.key,\r\n                            ...point,\r\n                        };\r\n                        res.push(point);\r\n                    })\r\n                }\r\n            })\r\n            return res;\r\n        }\r\n    },\r\n    methods:{\r\n        animate(time){\r\n            requestAnimationFrame(this.animate)\r\n            TWEEN.update(time)\r\n            // this.initPoint()\r\n            this.renderer.render(this.scene, this.camera); //执行渲染操作\r\n        },\r\n\r\n        initPoint(){\r\n            const tick = ()=>{\r\n                    // 添加交互点\r\n                const raycaster = new Three.Raycaster();\r\n                // 室内悬浮标记物\r\n                const _points = this.interactivePoints.map((item, index) => ({\r\n                    ...item,\r\n                    element: document.querySelector(`.point-${index}`),\r\n                }))\r\n                console.log('_points',_points);\r\n                if (this.renderer) {\r\n                    for (const point of _points) {\r\n                        const screenPosition = point.position.clone();\r\n                        const pos = screenPosition.project(this.camera);\r\n                        raycaster.setFromCamera(screenPosition, this.camera);\r\n                        const intersects = raycaster.intersectObjects(this.scene.children, true);\r\n                        console.log('intersects',intersects);\r\n                        point.element.classList.add('visible');\r\n                        if (intersects.length === 0) {\r\n                            // 未找到相交点，显示\r\n                            point.element.classList.add('visible');\r\n                        } else {\r\n                            // 获取相交点的距离和点的距离\r\n                            const intersectionDistance = intersects[0].distance;\r\n                            const pointDistance = point.position.distanceTo(this.camera.position);\r\n                            // 相交点距离比点距离近，隐藏；相交点距离比点距离远，显示\r\n                            intersectionDistance < pointDistance\r\n                                ? point.element.classList.remove(\"visible\")\r\n                                : point.element.classList.add(\"visible\");\r\n                        }\r\n                        // 物体转动到背面时隐藏，否则显示\r\n                        pos.z > 1\r\n                            ? point.element.classList.remove(\"visible\")\r\n                            : point.element.classList.add(\"visible\");\r\n\r\n                        const translateX = screenPosition.x * window.innerWidth * 0.5;\r\n                        const translateY = -screenPosition.y * window.innerHeight * 0.5;\r\n                        point.element.style.transform = `translateX(${translateX}px) translateY(${translateY}px)`;\r\n                    }\r\n                    this.controls && this.controls.update()\r\n                    TWEEN && TWEEN.update()\r\n                    // 更新渲染器\r\n                    this.renderer.render(this.scene, this.camera)\r\n                }\r\n            }\r\n            tick()\r\n            // window.requestAnimationFrame(tick);\r\n        },\r\n\r\n        handlePoint(key){\r\n            let start = {\r\n                x1: key.position.x, // 相机x\r\n                y1: key.position.y, // 相机y\r\n                z1: key.position.z, // 相机z\r\n                x2: this.controls.target.x, // 控制点的中心点x\r\n                y2: this.controls.target.y, // 控制点的中心点y\r\n                z2: this.controls.target.z, // 控制点的中心点z\r\n            }\r\n            let end ={\r\n                x1: 0,\r\n                y1: 0,\r\n                z1: 0,\r\n                x2: 0,\r\n                y2: 0,\r\n                z2: 2,\r\n            }\r\n            let tween = new TWEEN.Tween(start).to(end,2000).easing(TWEEN.Easing.Quadratic.Out)\r\n            tween.onUpdate((that)=>{\r\n                this.camera.position.set(that.x1,that.y1,that.z1)\r\n                this.controls.target.set(that.x2,that.y2,that.z2)\r\n                this.controls.update();\r\n            })\r\n            tween.start()\r\n            this.animate()\r\n        },\r\n\r\n        handleSwitch(key){\r\n            this.scene.children = []\r\n            const room = this.rooms.filter((item) => item.key === key)[0]\r\n            this.createRoom(room.key, room.position, room.map);\r\n            this.currentRoom = room.key;\r\n            const x = room.position.x;\r\n            const y = room.position.y;\r\n            // const z = room.position.z;\r\n            let start = {\r\n                x1: this.camera.position.x, // 相机x\r\n                y1: this.camera.position.y, // 相机y\r\n                z1: this.camera.position.z, // 相机z\r\n                x2: this.controls.target.x, // 控制点的中心点x\r\n                y2: this.controls.target.y, // 控制点的中心点y\r\n                z2: this.controls.target.z, // 控制点的中心点z\r\n            }\r\n            let end ={\r\n                x1: x,\r\n                y1: y,\r\n                z1: 0,\r\n                x2: x,\r\n                y2: y,\r\n                z2: 2,\r\n            }\r\n            let tween = new TWEEN.Tween(start).to(end,2000).easing(TWEEN.Easing.Quadratic.Out)\r\n            tween.onUpdate((that)=>{\r\n                this.camera.position.set(that.x1,that.y1,that.z1)\r\n                this.controls.target.set(that.x2,that.y2,that.z2)\r\n                this.controls.update();\r\n            })\r\n            tween.start()\r\n            this.animate()\r\n            this.initPoint()\r\n        },\r\n\r\n\r\n        // 球形贴图\r\n        init(){\r\n            let container = document.getElementById('container');\r\n            this.camera = new Three.PerspectiveCamera(65, container.clientWidth / container.clientHeight, 0.1, 1000);\r\n            this.camera.position.set(0,0,2)\r\n            this.scene = new Three.Scene();\r\n            this.renderer = new Three.WebGLRenderer({\r\n                antialias: true\r\n            });\r\n            //指定渲染器的高宽(和画布框的大小一致)\r\n            this.renderer.setPixelRatio(window.devicePixelRatio);\r\n            this.renderer.setSize(container.clientWidth, container.clientHeight);\r\n\r\n            container.appendChild(this.renderer.domElement);\r\n            this.controls = new OrbitControls(this.camera, this.renderer.domElement); // 初始化控制器\r\n            this.controls.target.set(0, 0, 8);\r\n            this.controls.enableDamping = true;\r\n            this.controls.enablePan = false;\r\n            // 缩放限制\r\n            this.controls.minDistance = 12;\r\n            this.controls.maxDistance = 20;\r\n            // this.rooms.map(item=>{\r\n            //     const room = this.createRoom(item.key, item.position, item.map);\r\n            //     console.log(room);\r\n            //     return room;\r\n            // })\r\n            this.handleSwitch(this.currentRoom)\r\n        },\r\n        createRoom(name,position,map){\r\n            let sphereGeometry = new Three.SphereGeometry(200, 60, 60);\r\n            sphereGeometry.scale(-1, 1, 1);\r\n            var textureLoader = new Three.TextureLoader();\r\n            const texture = textureLoader.load(map);\r\n            const material = new Three.MeshBasicMaterial(\r\n                {\r\n                    map: texture,\r\n                    side: Three.DoubleSide\r\n                })\r\n            const room = new Three.Mesh(sphereGeometry, material);\r\n            room.name = name;\r\n            room.position.set(position.x, position.y, position.z);\r\n            room.rotation.y = Math.PI / 2;\r\n            this.scene.add(room);\r\n            return room;\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n    #container {\r\n\t\twidth: 100%;\r\n        height: 1080px;\r\n\t}\r\n    .switch{\r\n        position: fixed;\r\n        right: 24px;\r\n        top: 40%;\r\n        z-index: 100;\r\n        .button{\r\n            width: 80px;\r\n            color: #fff;\r\n            display: block;\r\n            background-color: rgba(27, 25, 24, .3);\r\n            border-radius: 6px;\r\n            margin-bottom: 10px;\r\n            display: flex;\r\n            align-items: center;\r\n            text-align: center;\r\n            padding: 12px 8px 12px 24px;\r\n            cursor: pointer;\r\n        }\r\n    }\r\n\r\n    .point{\r\n        // background-color: antiquewhite;\r\n        position: fixed;\r\n        top: 50%;\r\n        left: 50%;\r\n        z-index:10;\r\n    }\r\n \r\n      \r\n    .label-sofa{\r\n        .label-tips\r\n         {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            left: -220px;\r\n            flex-direction: row-reverse;\r\n         }\r\n    }\r\n       \r\n    .label{\r\n        transform: scale(0, 0);\r\n        width: 120px;\r\n        height: 60px;\r\n        background: rgba(255, 255, 255, .6);\r\n        border-radius: 10px;\r\n        padding: 10px;\r\n        text-align: center;\r\n        line-height: 32px;\r\n        font-weight: 100;\r\n        font-size: 14px;\r\n        cursor: help;\r\n        .label-tips{\r\n            display: flex;\r\n            justify-content: space-between;\r\n            .info{\r\n                .p1{\r\n                    font-size: 16px;\r\n                    font-weight: bold;\r\n                }\r\n            }\r\n            .cover{\r\n                width:20%;\r\n                height: 60px;\r\n                .icon{\r\n                    display: block;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                }\r\n            }\r\n            \r\n        }\r\n    }\r\n    .visible .label{\r\n        transform: scale(1, 1);\r\n    }\r\n</style>"]}]}